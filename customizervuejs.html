<!DOCTYPE html>
<html>

<head>
  <title>Sadhaka Customizer</title>
  <!-- Include Firebase -->
  <script src="https://www.gstatic.com/firebasejs/8.0.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.0.1/firebase-firestore.js"></script>
  <style>
    body {
      background-color: #f0f0f0;
      color: #333333;
      font-family: Arial, sans-serif;
      padding: 20px;
    }

    h1 {
      margin-bottom: 20px;
      color: #003366;
    }

    input,
    textarea {
      width: 100%;
      padding: 10px;
      border-radius: 5px;
      border: 1px solid #cccccc;
      background-color: #ffffff;
      color: #333333;
    }

    button,
    .delete-button {
      padding: 10px 20px;
      border-radius: 5px;
      border: none;
      background-color: #4c7d7e;
      color: #ffffff;
      cursor: pointer;
    }

    button:hover,
    .delete-button:hover {
      background-color: #72b1b2;
    }

    #sadhakaDiv {
      margin-top: 50px;
      margin-bottom: 20px;
      max-height: 200px;
      overflow-y: auto;
      border: 1px solid #cccccc;
      border-radius: 5px;
      box-shadow: 0px 1px 3px rgba(0, 0, 0, 0.12), 0px 1px 2px rgba(0, 0, 0, 0.24);
      transition: all 0.3s cubic-bezier(.25, .8, .25, 1);
    }

    #sadhakaDiv:hover {
      box-shadow: 0px 2px 4px rgba(0, 0, 0, 0.25), 0px 2px 3px rgba(0, 0, 0, 0.22);
    }

    #sadhakaDiv div {
      margin-top: 50px;
      margin-bottom: 10px;
    }

    .suggestions {
      position: relative;
      background-color: #f0f0f0;
      color: #333333;
      padding: 10px;
      max-height: 150px;
      overflow-y: auto;
      z-index: 1;
      display: none;
      /* Add this line */
    }

    .suggestions div {
      cursor: pointer;
      padding: 5px;
    }
  </style>
</head>

<body>
  <h1>Sadhaka Customizer</h1>
  <input type="text" id="sadhakaName" oninput="sadhakaNameChanged(this.value)">
  <div id="sadhakaNameSuggestions" class="suggestions"></div>


  <div id="sadhakaDiv">
    <!-- Assigned Asanas will go here -->
  </div>
  <button onclick="addAsana()">Add Asana</button>

  <textarea id="dietAndAdditionalNotes"></textarea>

  <button onclick="saveSadhaka()">Save Sadhaka</button>


  <script>
    // Initialize Firebase
    // TODO: replace with your own Firebase config
    var firebaseConfig = {
      apiKey: "AIzaSyD2Qv-8dC9atWBU_IFWXmxsGSp5T-_FOtM",
      authDomain: "sadhakacustomizer.firebaseapp.com",
      projectId: "sadhakacustomizer",
      storageBucket: "sadhakacustomizer.appspot.com",
      messagingSenderId: "401905258509",
      appId: "1:401905258509:web:cd9661bbe700b04fa00544"
    };
    firebase.initializeApp(firebaseConfig);
    var db = firebase.firestore();

    var asanas = [];  // TODO: load Asanas from JSON

    function loadSadhaka() {
      db.collection('sadhakas').doc('sadhaka1').get().then((doc) => {
        if (doc.exists) {
          displaySadhaka(doc.data());
        }
      }).catch((error) => {
        console.log("Error getting document:", error);
      });
    }

    function displaySadhaka(sadhaka) {
      var sadhakaDiv = document.getElementById('sadhakaDiv');
      sadhakaDiv.innerHTML = ''; // Clear the div

      sadhaka.assignedAsanas.forEach((asana, index) => {
        var asanaDiv = document.createElement('div');
        asanaDiv.style.display = 'flex'; // Add this line
        asanaDiv.style.justifyContent = 'space-between'; // Add this line to space the elements
        asanaDiv.style.marginBottom = '10px'; // Add some margin for spacing

        var asanaNameInput = document.createElement('input');
        asanaNameInput.value = asana.asanaName;
        asanaNameInput.style.flexGrow = '1'; // Add this line to allow the input to take up available space
        asanaNameInput.style.marginRight = '10px'; // Add some margin for spacing
        asanaDiv.appendChild(asanaNameInput);

        var deleteButton = document.createElement('button');
        deleteButton.textContent = 'Delete';
        deleteButton.className = 'delete-button';
        deleteButton.onclick = function () {
          asanaDiv.remove();
        }
        asanaDiv.appendChild(deleteButton);

        sadhakaDiv.appendChild(asanaDiv);
      });

      document.getElementById('dietAndAdditionalNotes').value = sadhaka.dietAndAdditionalNotes;
    }



    function addAsana() {
      var sadhakaDiv = document.getElementById('sadhakaDiv');

      var asanaDiv = document.createElement('div');
      asanaDiv.style.display = 'flex'; // Add this line
      asanaDiv.style.justifyContent = 'space-between'; // Add this line to space the elements
      asanaDiv.style.marginBottom = '10px'; // Add some margin for spacing

      var asanaNameInput = document.createElement('input');
      asanaNameInput.style.flexGrow = '1'; // Add this line to allow the input to take up available space
      asanaNameInput.style.marginRight = '10px'; // Add some margin for spacing
      asanaDiv.appendChild(asanaNameInput);

      var deleteButton = document.createElement('button');
      deleteButton.textContent = 'Delete';
      deleteButton.className = 'delete-button';
      deleteButton.onclick = function () {
        asanaDiv.remove();
      }
      asanaDiv.appendChild(deleteButton);

      sadhakaDiv.appendChild(asanaDiv);
    }


    var sadhakaNames = [];

    function loadSadhakaNames() {
      db.collection('sadhakas').get().then((querySnapshot) => {
        querySnapshot.forEach((doc) => {
          sadhakaNames.push(doc.id);
        });
      });
    }

    function sadhakaNameChanged(name) {
      var suggestionsDiv = document.getElementById('sadhakaNameSuggestions');
      suggestionsDiv.innerHTML = ''; // clear previous suggestions
      suggestionsDiv.style.display = 'none'; // Add this line

      var matchingNames = sadhakaNames.filter(sadhakaName => sadhakaName.startsWith(name));
      if (matchingNames.length > 0) { // Add this line
        suggestionsDiv.style.display = 'block'; // Add this line
      }
      matchingNames.forEach(sadhakaName => {
        var suggestionDiv = document.createElement('div');
        suggestionDiv.textContent = sadhakaName;
        suggestionDiv.onclick = function () {
          document.getElementById('sadhakaName').value = sadhakaName;
          suggestionsDiv.innerHTML = ''; // clear suggestions
          suggestionsDiv.style.display = 'none'; // Add this line
        };
        suggestionsDiv.appendChild(suggestionDiv);
      });

      // load Sadhaka details
      loadSadhaka(name);
    }



    function loadSadhaka(name) {
      db.collection('sadhakas').doc(name).get().then((doc) => {
        if (doc.exists) {
          displaySadhaka(doc.data());
        } else {
          displaySadhaka({
            name: name,
            assignedAsanas: [],
            dietAndAdditionalNotes: ''
          });
        }
      }).catch((error) => {
        console.log("Error getting document:", error);
      });
    }

    function saveSadhaka() {
      var name = document.getElementById('sadhakaName').value;
      if (!name) {
        alert('Sadhaka name is required');
        return;
      }

      var sadhakaDiv = document.getElementById('sadhakaDiv');
      var asanaDivs = Array.from(sadhakaDiv.children);

      var assignedAsanas = asanaDivs.map((asanaDiv) => {
        var asanaName = asanaDiv.children[0].value;
        return { asanaName: asanaName };
      });

      var dietAndAdditionalNotes = document.getElementById('dietAndAdditionalNotes').value;

      var sadhaka = {
        assignedAsanas: assignedAsanas,
        dietAndAdditionalNotes: dietAndAdditionalNotes
      };

      db.collection('sadhakas').doc(name).set(sadhaka).then(() => {
        console.log("Document successfully written!");
        if (!sadhakaNames.includes(name)) {
          sadhakaNames.push(name);
        }
      }).catch((error) => {
        console.error("Error writing document: ", error);
      });
    }


    loadSadhaka();
  </script>
</body>

</html>