<!DOCTYPE html>
<html>

<head>
    <title>Image to Sketch Converter</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.3.1/p5.js"></script>
    <style>
        :root {
            --main-bg-color: #333;
            --main-text-color: #f5f5f5;
            --main-accent-color: #6699cc;
            --hover-accent-color: #88bbff;
            --radius: 8px;
            --transition-time: 0.2s;
        }

        body {
            background-color: var(--main-bg-color);
            color: var(--main-text-color);
            font-family: 'Arial', sans-serif;
            display: grid;
            place-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 0;
        }

        .app {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 2rem;
        }

        #fileUpload, button {
            appearance: none;
            background-color: var(--main-accent-color);
            color: var(--main-text-color);
            padding: 0.8rem 1.6rem;
            border-radius: var(--radius);
            border: none;
            cursor: pointer;
            transition: background-color var(--transition-time);
        }

        #fileUpload:hover, button:hover {
            background-color: var(--hover-accent-color);
        }

        #canvasContainer {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
            overflow: auto;
        }
    </style>
</head>

<body>
    <div class="app">
        <input type="file" id="fileUpload" accept="image/*" onchange="previewImage(event)" />
        <div id="canvasContainer"></div>
        <button id="download" onclick="downloadImage()">Download Image</button>
    </div>



    <script>
        let img;
        let original;
        let canvas;

        function setup() {
            canvas = createCanvas(500, 500);
            canvas.parent('canvasContainer');
            img = createImage(500, 500);
            original = createImage(500, 500);
            noLoop();
        }

        function draw() {
            background(220);
            if (img) {
                image(img, 0, 0, width, height);
            }
        }

        function previewImage(event) {
            let reader = new FileReader();
            reader.onload = function () {
                loadImage(reader.result, function (loadedImage) {
                    original = loadedImage;
                    sketchImage();
                });
            };
            reader.readAsDataURL(event.target.files[0]);
        }

        function sketchImage() {

            img = original.get();
            img.filter(GRAY);

            img.loadPixels();
            let imgCopy = createImage(img.width, img.height);
            imgCopy.loadPixels();

            let kernel = [
                [-1, -1, -1],
                [-1, 8, -1],
                [-1, -1, -1]
            ];

            for (let x = 1; x < img.width - 1; x++) {
                for (let y = 1; y < img.height - 1; y++) {
                    let sum = [0, 0, 0];
                    for (let i = -1; i <= 1; i++) {
                        for (let j = -1; j <= 1; j++) {
                            let xpos = x + i;
                            let ypos = y + j;
                            let index = (xpos + ypos * img.width) * 4;
                            for (let c = 0; c < 3; c++) {
                                sum[c] += img.pixels[index + c] * kernel[j + 1][i + 1];
                            }
                        }
                    }
                    let index = (x + y * img.width) * 4;
                    for (let c = 0; c < 3; c++) {
                        sum[c] = constrain(sum[c], 0, 255);
                        imgCopy.pixels[index + c] = sum[c];
                    }
                    imgCopy.pixels[index + 3] = 255;  // Set alpha to maximum
                }
            }

            imgCopy.updatePixels();
            img = imgCopy;
            img.filter(INVERT); // Invert the colors
            redraw();
        }





        function downloadImage() {
            saveCanvas(canvas, 'sketch', 'png');
        }
    </script>
</body>

</html>